DROP DATABASE IF EXISTS qna;

CREATE DATABASE qna;

\c qna;

CREATE TABLE IF NOT EXISTS questions (
  id integer GENERATED BY DEFAULT AS IDENTITY UNIQUE PRIMARY KEY,
  product_id varchar(15),
  body text,
  date_written text,
  asker_name varchar(50),
  asker_email varchar(255),
  reported boolean,
  helpful varchar(15)
);

COPY questions
FROM '/Users/mtanaka/HackReactor/SDC_data/questions.csv'
DELIMITER ','
CSV HEADER;

ALTER TABLE questions
RENAME COLUMN id TO question_id;

ALTER TABLE questions
RENAME COLUMN body TO question_body;

ALTER TABLE questions
RENAME COLUMN date_written TO question_date;

ALTER TABLE questions
RENAME COLUMN helpful TO question_helpfulness;


CREATE TABLE IF NOT EXISTS answers (
  id integer GENERATED BY DEFAULT AS IDENTITY UNIQUE PRIMARY KEY,
  question_id int,
  body text,
  date_written text,
  answerer_name varchar(50),
  answerer_email varchar(255),
  reported boolean,
  helpful varchar(15),
  FOREIGN KEY (question_id) REFERENCES questions (id)
);

COPY answers
FROM '/Users/mtanaka/HackReactor/SDC_data/answers.csv'
DELIMITER ','
CSV HEADER;

ALTER TABLE answers
RENAME COLUMN id TO answer_id;

ALTER TABLE answers
RENAME COLUMN date_written TO date;

ALTER TABLE answers
RENAME COLUMN helpful TO helpfulness;

CREATE TABLE IF NOT EXISTS answers_photos (
  id integer GENERATED BY DEFAULT AS IDENTITY UNIQUE PRIMARY KEY,
  answer_id int,
  photo_url text,
  FOREIGN KEY (answer_id) REFERENCES answers (id)
);

COPY answers_photos
FROM '/Users/mtanaka/HackReactor/SDC_data/answers_photos.csv'
DELIMITER ','
CSV HEADER;

ALTER TABLE answers_photos
RENAME COLUMN photo_url TO url;


-- tells us that the output of to_stamp is "timestamp with timezone"
SELECT PG_TYPEOF(TO_TIMESTAMP(1599958385988::double precision/1000));

SELECT TO_CHAR(TO_TIMESTAMP(date::double precision/1000), 'DD-MM-YYYY"T"HH24:MI:SS.MS"Z"') AS date_converted FROM answers WHERE answer_id='1';

'2020-09-12 17:53:05.988-07'

'YYYY-MM-DD"T"HH24:MI:SS"Z"'


"2018-01-04T00:00:00.000Z"